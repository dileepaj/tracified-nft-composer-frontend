<div class="modal-parent-query-editor21"
  fxLayout="column" fxLayoutAlign="space-between center"
  >
  <mat-dialog-content fxLayout="column" fxFlex="90"
    class="mat-typography modal-content"
    disableClose
  >
    <mat-tab-group
      (selectedTabChange)="tabChanged($event)"
      [(selectedIndex)]="tabIndex"
      fxLayout="column" fxFlexFill
    >
      <mat-tab label="Query" fxLayout="row">
        <mat-grid-list cols="5" rowHeight="60vh">
          <!--Column that displays the bar chart-->
          <mat-grid-tile colspan="5">
            <app-ldaleditor
              [id]="bubbleChart.WidgetId"
              [type]="'bubble'"
              [query]="bubbleChart.Query!"
              [widget]="bubbleChart"
              (onQueryResult)="onQueryResult($event)"
            ></app-ldaleditor>
          </mat-grid-tile>
        </mat-grid-list>
      </mat-tab>
      <mat-tab label="Chart Configuration" fxLayout="row" *ngIf="CheckQuerySavingStatus()">
        <mat-grid-list class="bubble-chart-view" cols="5" [rowHeight]="rowHeight">
          <!--Column that displays the bar chart-->
          <mat-grid-tile [colspan]="colspan1" fxLayoutAlign="center strat">
            <!--Bar chart-->
            <div class="bubble-chart" fxLayoutAlign="center center">
              <canvas
                baseChart
                class="bubble-chart-canvas"
                [id]="'bubble-chart'"
              >
              </canvas>
            </div>
          </mat-grid-tile>

          <!--Column that displays the configuration panel-->
          <mat-grid-tile colspan="2" *ngIf="!rowHeightMobile" class="form-tile">
            <div class="form-div">
              <h2>
                <mat-icon class="title-icon">tune</mat-icon>Configure Chart
              </h2>
              <div fxLayout="row wrap">
                <!--input field for setting x axis name-->
                <mat-form-field appearance="fill" color="primary" fxFlex="100%">
                  <mat-label>Title</mat-label>
                  <input
                    matInput
                    type="text"
                    maxlength="15"
                    minlength="1"
                    [(ngModel)]="title"
                    (ngModelChange)="drawChart()"
                  />
                </mat-form-field>
                <!--input field for setting x axis name-->
                <mat-form-field appearance="fill" color="primary" fxFlex="45%">
                  <mat-label>X Axis Name</mat-label>
                  <input
                    matInput
                    type="text"
                    [(ngModel)]="xName"
                    (ngModelChange)="drawChart()"
                  />
                </mat-form-field>

                <!--input field for setting y axis name-->
                <mat-form-field
                  appearance="fill"
                  color="primary"
                  fxFlex="45%"
                  style="float: right"
                >
                  <mat-label>Y Axis Name</mat-label>
                  <input
                    matInput
                    type="text"
                    [(ngModel)]="yName"
                    (ngModelChange)="drawChart()"
                  />
                </mat-form-field>
                <mat-form-field appearance="fill" fxFlex="45%">
                  <mat-label>Font size</mat-label>
                  <input
                    matInput
                    type="number"
                    placeholder="Ex. 12"
                    [max]="15"
                    [min]="1"
                    (keydown)="fontSizeInput($event)"
                    [(ngModel)]="fontSize"
                    (ngModelChange)="drawChart()"
                  />
                  <span matSuffix>px</span>
                </mat-form-field>
                <div
                  class="colorbox-font"
                  [(colorPicker)]="fontColor"
                  [style.background]="fontColor"
                  (colorPickerChange)="drawChart()"
                ></div>
              </div>

              <div class="domain"></div>

              <!--Values displayed in the bar chart-->
              <div class="bubble-chart-fields">
                <h3>Bubble Chart Fields</h3>
                <div
                  class="field"
                  *ngFor="let field of bubbleChartData; index as i"
                >
                  <mat-card class="field-card">
                    <div class="input-set">
                      <input
                        type="text"
                        class="field-name-input"
                        maxlength="15"
                        [value]="field.Name"
                        (keyup.enter)="saveFieldName()"
                        (input)="setFieldName($event, i)"
                        *ngIf="fieldControlEnabledIndex === i"
                      />
                      <label
                        *ngIf="
                          fieldControlEnabledIndex === -1 ||
                          fieldControlEnabledIndex !== i
                        "
                        style="
                          vertical-align: middle;
                          max-width: 230px;
                          overflow: hidden;
                        "
                        >{{ field.Name }}</label
                      >
                      <mat-icon
                        matRipple
                        matTooltip="Edit field name"
                        class="material-icons-outlined field-save-icon"
                        style="vertical-align: middle; transform: scale(0.8)"
                        *ngIf="
                          fieldControlEnabledIndex === -1 ||
                          fieldControlEnabledIndex !== i
                        "
                        (click)="enableFieldOptions(i)"
                      >
                        edit
                      </mat-icon>
                      <mat-icon
                        matRipple
                        matTooltip="Save field name"
                        class="field-save-icon"
                        style="vertical-align: middle; transform: scale(0.8)"
                        *ngIf="fieldControlEnabledIndex === i"
                        (click)="saveFieldName()"
                      >
                        done
                      </mat-icon>
                      <mat-icon
                        matRipple
                        matTooltip="Cancel"
                        class="field-save-icon"
                        style="vertical-align: middle; transform: scale(0.8)"
                        *ngIf="fieldControlEnabledIndex === i"
                        (click)="disableFieldOptions()"
                      >
                        close
                      </mat-icon>
                    </div>
                    <div
                      class="colorbox"
                      [(colorPicker)]="bubbleColors[i]"
                      [style.background]="bubbleColors[i]"
                      (colorPickerChange)="drawChart()"
                    ></div>
                  </mat-card>
                </div>
              </div>
            </div>
          </mat-grid-tile>
        </mat-grid-list>
        <mat-grid-list cols="5" rowHeight="550px" *ngIf="rowHeightMobile">
          <!--Column that displays the configuration panel-->
          <mat-grid-tile colspan="5" class="form-tile">
            <div class="form-div">
              <h2>
                <mat-icon class="title-icon">tune</mat-icon>Configure Chart
              </h2>
              <div fxLayout="row wrap">
                <!--input field for setting x axis name-->
                <mat-form-field appearance="fill" color="primary" fxFlex="100%">
                  <mat-label>Title</mat-label>
                  <input
                    matInput
                    type="text"
                    maxlength="15"
                    minlength="1"
                    [(ngModel)]="title"
                    (ngModelChange)="drawChart()"
                  />
                </mat-form-field>
                <!--input field for setting x axis name-->
                <mat-form-field appearance="fill" color="primary" fxFlex="45%">
                  <mat-label>X Axis Name</mat-label>
                  <input
                    matInput
                    type="text"
                    [(ngModel)]="xName"
                    (ngModelChange)="drawChart()"
                  />
                </mat-form-field>

                <!--input field for setting y axis name-->
                <mat-form-field
                  appearance="fill"
                  color="primary"
                  fxFlex="45%"
                  style="float: right"
                >
                  <mat-label>Y Axis Name</mat-label>
                  <input
                    matInput
                    type="text"
                    [(ngModel)]="yName"
                    (ngModelChange)="drawChart()"
                  />
                </mat-form-field>
                <mat-form-field appearance="fill" fxFlex="45%">
                  <mat-label>Font size</mat-label>
                  <input
                    matInput
                    type="number"
                    placeholder="Ex. 12"
                    min="2"
                    max="15"
                    (keydown)="fontSizeInput($event)"
                    [(ngModel)]="fontSize"
                    (ngModelChange)="drawChart()"
                  />
                  <span matSuffix>px</span>
                </mat-form-field>
                <div
                  class="colorbox-font"
                  [(colorPicker)]="fontColor"
                  [style.background]="fontColor"
                  (colorPickerChange)="drawChart()"
                ></div>
              </div>

              <div class="domain"></div>

              <!--Values displayed in the bar chart-->
              <div class="bubble-chart-fields">
                <h3>Bubble Chart Fields</h3>
                <div
                  class="field"
                  *ngFor="let field of bubbleChartData; index as i"
                >
                  <mat-card class="field-card">
                    <div class="input-div">
                      <input
                        type="text"
                        class="field-name-input"
                        maxlength="15"
                        [value]="field.Name"
                        (keyup.enter)="saveFieldName()"
                        (input)="setFieldName($event, i)"
                        *ngIf="fieldControlEnabledIndex === i"
                      />
                      <label
                        *ngIf="
                          fieldControlEnabledIndex === -1 ||
                          fieldControlEnabledIndex !== i
                        "
                        style="
                          vertical-align: middle;
                          max-width: 230px;
                          overflow: hidden;
                        "
                        >{{ field.Name }}</label
                      >
                      <mat-icon
                        matRipple
                        matTooltip="Edit field name"
                        class="material-icons-outlined field-save-icon"
                        style="vertical-align: middle; transform: scale(0.8)"
                        *ngIf="
                          fieldControlEnabledIndex === -1 ||
                          fieldControlEnabledIndex !== i
                        "
                        (click)="enableFieldOptions(i)"
                      >
                        edit
                      </mat-icon>
                      <mat-icon
                        matRipple
                        matTooltip="Save field name"
                        class="field-save-icon"
                        style="vertical-align: middle; transform: scale(0.8)"
                        *ngIf="fieldControlEnabledIndex === i"
                        (click)="saveFieldName()"
                      >
                        done
                      </mat-icon>
                      <mat-icon
                        matRipple
                        matTooltip="Cancel"
                        class="field-save-icon"
                        style="vertical-align: middle; transform: scale(0.8)"
                        *ngIf="fieldControlEnabledIndex === i"
                        (click)="disableFieldOptions()"
                      >
                        close
                      </mat-icon>
                    </div>
                    <div
                      class="colorbox"
                      [(colorPicker)]="bubbleColors[i]"
                      [style.background]="bubbleColors[i]"
                      (colorPickerChange)="drawChart()"
                    ></div>
                  </mat-card>
                </div>
              </div>
            </div>
          </mat-grid-tile>
        </mat-grid-list>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>
  <div class="modal-footer modal-footer-btn" fxLayout="raw" fxLayoutAlign="end center">>
    <mat-dialog-actions fxLayoutAlign="end center">
      <button mat-button (click)="onCancel()" class="btn-cancel">Cancel</button>

      <button
        mat-button
        [disabled]="saving || !querySuccess"
        class="btn"
        (click)="updateReduxState()"
      >
        <mat-icon>save</mat-icon>
        <span [class.spinner]="saving"> </span>
        Save
      </button>
    </mat-dialog-actions>
  </div>
</div>
